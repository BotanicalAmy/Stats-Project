---
title: 'MATH 324 Final Project'
author: "Amy Cao, Amy Folkestad, Anker Hojgaard and Jaxson Stathis"
output:
  pdf_document: default
  html_notebook: default
---

  
```{r, include = F, warning=F, message=F}
# front-matter
rm(list = ls()) #clear the workspace

library(Stat2Data)
library(tidyverse)
library(mosaic)
library(ggformula)
library(emmeans)
library(knitr)
library(kableExtra)
library(dplyr)
library(car)
library(ggplot2)


knitr::opts_chunk$set(echo = F)

# URL to the raw CSV file on GitHub
# this clean version has a series of dates that with odd formatting and missing year and month values as a result
# the dates were reformatted for the affected rows, months and years replaced the missing values

# Use the raw content URL instead of the repository page URL
file_url <- "https://raw.githubusercontent.com/BotanicalAmy/Stats-Project/main/hotel_booking_clean.csv"
hotel_bookings <- read.csv(file_url, header = TRUE)

```

```{r}
# new column GroupSize by adding Adults and Children
hotel_bookings$GroupSize <- hotel_bookings$Adults + hotel_bookings$Children

# new column StayLength by adding weekend and weeknights
hotel_bookings$StayLength <- hotel_bookings$Weekends + hotel_bookings$Weeknights

# Add HasChildren column
hotel_bookings$HasChildren <- ifelse(hotel_bookings$Children > 0, 1, 0)

# Add HasRequest column
hotel_bookings$HasRequests <- ifelse(hotel_bookings$Requests > 0, 1, 0)

# Preview the data
# head(hotel_bookings)

```

# 1. Project Description

*Should be in paragraph form (not bullets).  Written for a 3rd party client that may not have a strong statistical background. As part of your description, consider the following:*

Gold Mine Resorts is looking to understand the predictors for guests who cancel their reservations.The industry average for cancellation rates is twenty percent; however Gold Mine Resorts experienced a 32.8% cancellation rate for reservations between 2015 and 2018. Cancelled reservations represent a total of $4.3 million dollars in lost revenue for this time frame.

- *Description of the dataset*

The dataset includes 36,285 rows of booking data, spanning the course of four years (2015-2018). Data collected includes the group size (adult and children), the stay length (count of weekend and weeknight stays), guest upgrades (parking, meal plans, room types and count of special requests), booking details (price and reservation method), the date of stay, and status (whether or not the guest cancelled the reservation).

Our team observed there was only one row of data for year 2015 and 2016. We additionally noticed there only 5 data points for meal plan 3. GroupSize, StayLength, HasChildren, and HasRequests were created from the existing dataset. GroupSize was an aggregation of count of adults and children, StayLength was an aggregation of Weekend and Weeknigths. HasChildren and HasRequests created binary, true/false (0 and 1) variables from the count of children and requests.

The status column (cancelled verses not cancelled), is the response variable of interest in this analysis.

- *Goal of study*

## 1.1 Research Objectives

The goal of this analysis is to understand the best predictors for guest cancellations in order to develop company policy to decrease the cancellation rate. Lowering the percent cancellation rate to 20% represents a revenue increase of approximately $2 million dollars over four years. 

*What are the overarching research objectives that the study is targeting? (not just a restatement of the original research objectives)*

**Objective 1:**  

The first objective will explore and define the most important quantitative variable for predicting whether a customer will cancel their reservation.

**Objective 2:**

The second objective will explore and define the most important categorical variable for predicting whether a customer will cancel their reservation.

**Objective 3:**

The final goal of our statistical analysis will combine our understanding of quantitative and categorical variables in order to create a final statistical model to predict the customers who are most likely to cancel their reservations.


## 1.2 Variables

*What is (are) possible explanatory and response variables?*

The response variable of interest is status, whether or not a client cancelled their booking. The possible explanatory variables include both categorical and quantitative options. The number of requests from a client was converted to a categorical variable. A new column called HasRequests was created, with 1 indicating the customer had a special request. We made a similar to transformation to the children column, transforming this into a binary column indicating whether or not there were children in the group.


*Create a table here - it should include variable names and types*


|            | Description of Variable  | Variable Type |
|:----------:|:------------------------:|:-------------:|
| Status     |   Cancellation status of |       C       |
|            |   booking                |               |
|:----------:|:------------------------:|:-------------:|
| Meal       |   Type of meal in the    |       C       |
|            |   booking                |               |
|:----------:|:------------------------:|:-------------:|
| Parking    | Whether or not a parking |       C       |
|            | space is in the booking  |               |
|:----------:|:------------------------:|:-------------:|
| RoomType   |  Type of room booked     |       C       |
|:----------:|:------------------------:|:-------------:|
| Market     | Market segment of booking|       C       |
|:----------:|:------------------------:|:-------------:|
| Month      | Month of booking date    |       C       |
|:----------:|:------------------------:|:-------------:|
| Requests   | Num. of special requests |       C       |
|            | made by the customer     |               |
|:----------:|:------------------------:|:-------------:|
|HasChildren | Indicates whether or not |       C       |
|            | the booking has children |               |
|:----------:|:------------------------:|:-------------:| 
|HasRequests | Whether the booking had  |       C       |
|            | any special requests     |               |
|:----------:|:------------------------:|:-------------:| 
| Adults     |  Number of adults in the |       Q       |
|            |  booking                 |               |
|:----------:|:------------------------:|:-------------:|
| Children   | Number of children in the|       Q       |
|            | booking                  |               |
|:----------:|:------------------------:|:-------------:|
| GroupSize  | Number of people in the  |       Q       |
|            | booking                  |               |
|:----------:|:------------------------:|:-------------:|
| StayLength | Total of weekend plus    |       Q       |
|            | weeknights               |               |
|:----------:|:------------------------:|:-------------:|
| Weekends   | Number of weekend nights |       Q       |
|            | in the booking           |               |
|:----------:|:------------------------:|:-------------:|
| Weeknights | Number of weeknights in  |       Q       |
|            | the booking              |               |
|:----------:|:------------------------:|:-------------:|
| LeadTime   | Number of days between   |       Q       |
|            | booking date and arrival |               |
|:----------:|:------------------------:|:-------------:|
| AvgPrice   | Average room price on the|       Q       |
|            | week of the booking      |               |
|:----------:|:------------------------:|:-------------:|
| Year       | Year of the reservation  |       Q       |
|:----------:|:------------------------:|:-------------:|




#  2. Detailed Exploratory Data Analysis (EDA)

*Spend time investigating the data thoroughly and use this section to present figures that allow you to visualize the relationship of the response to different predictors.  Include descriptions of the figures that illustrate what you can learn from them.*

### Quantitative EDA

For our quantitative exploration, we focused on the aggregated data columns of group size and stay length, in addition to the average price and lead time variables. We did not address children in the quantitative exploration, because we converted the presence of children into categorical variable of HasChildren.

Looking at the side by side box plot, the lead time has the most value for predicting cancellations.

```{r}
# quantitative EDA

# Compare means of each quantitative variable between canceled and not canceled groups
group_comparison <- hotel_bookings %>%
  group_by(Status) %>%
  summarize(
    Mean_LeadTime = mean(LeadTime, na.rm = TRUE),
    Mean_AvgPrice = mean(AvgPrice, na.rm = TRUE),
    Mean_GroupSize = mean(GroupSize, na.rm = TRUE),
    Mean_StayLength = mean(StayLength, na.rm = TRUE)
  )

# Round numeric columns to 3 decimal places
group_comparison_formatted <- group_comparison %>%
  mutate(across(where(is.numeric), ~round(., 3)))

# Create pretty kable table
kable(group_comparison_formatted, caption = "Quantitative Explanatory Variables") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                full_width = FALSE) %>%
  column_spec(1, bold = TRUE) %>%
  row_spec(0, bold = TRUE, background = "#E8E8E8")


hotel_long <- hotel_bookings %>%
  select(Status, LeadTime, AvgPrice, GroupSize, StayLength) %>%
  pivot_longer(cols = c(LeadTime, AvgPrice, GroupSize, StayLength),
               names_to = "Variable",
               values_to = "Value")

# faceted boxplots for quantitative variables
ggplot(hotel_long, aes(x = Status, y = Value, fill = Status)) +
  geom_boxplot() +
  facet_wrap(~ Variable, scales = "free_y") +
  scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4")) +
  labs(title = "Comparison of quantitative variables by cancellation status") +
  theme_minimal() 

```

### Categorical EDA

For our categorical exploration, we created side by side bar plots for room type, meal, market, month, request and if the group had children.

Looking at the side by side bar plots, the requests appeared to be the most useful variable, followed by month and market.

```{r fig.width=6, fig.height=5}
# categorical EDA
# Create a bar chart with white background and title
gf_bar(~RoomType, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellation by Room Type",
    x = "Room Type",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 1),
      legend.position = "bottom"
    )
  )

```

```{r fig.width=7, fig.height=5}

gf_bar(~Meal, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellation by Meal Type",
    x = "Meal Type",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
  )

gf_bar(~Market, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellation by Market Segment",
    x = "Market Segment",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
  )

```
```{r fig.width=8, fig.height=5}
# abbreviated month names in chronological order
month_order <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", 
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")

# Convert Month to factor with levels in chronological order
hotel_bookings$Month <- factor(hotel_bookings$Month, levels = month_order)

# Create the bar chart with chronologically ordered months
gf_bar(~Month, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellations by Month",
    x = "Month",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
  )

```
```{r fig.width=4, fig.height=5}
gf_bar(~HasChildren, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellation by HasChildren",
    x = "Has Children (0 = No, 1 = Yes)",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
  )

gf_bar(~Parking, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellation by Parking Option",
    x = "Parking",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
  )

gf_bar(~HasRequests, fill=~Status, data = hotel_bookings) %>%
  gf_labs(
    title = "Cancellations by HasRequest",
    x = "Had a special request",
    y = "Count"
  ) %>%
  gf_refine(
    scale_fill_manual(values = c("Canceled" = "#FF6B6B", "Not_Canceled" = "#4ECDC4"))
  ) %>%
  gf_theme(
    theme_minimal() +
    theme(
      plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
      legend.position = "bottom"
    )
)

```

```{r}
# function to generate proportion tables
create_prop_table <- function(data, group_var) {
  group_var <- enquo(group_var)
  
  data %>%
    group_by(!!group_var, Status) %>%
    summarise(count = n(), .groups = "drop") %>%
    group_by(!!group_var) %>%
    mutate(proportion = count / sum(count))
}

# Now use the function with each variable
room_type_table <- create_prop_table(hotel_bookings, RoomType)
meal_table <- create_prop_table(hotel_bookings, Meal)
market_table <- create_prop_table(hotel_bookings, Market)
parking_table <- create_prop_table(hotel_bookings, Parking)
month_table <- create_prop_table(hotel_bookings, Month)
requests_table <- create_prop_table(hotel_bookings, HasRequests)
children_table <- create_prop_table(hotel_bookings, HasChildren)

# Function to create a nicely formatted kable table with rounded proportions
print_pretty_kable <- function(table_data, title) {
  table_data <- table_data %>%
    mutate(proportion = round(proportion, 3))
  
  kable(table_data, caption = title) %>%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                  full_width = FALSE) %>%
    column_spec(1, bold = TRUE) %>%
    row_spec(0, bold = TRUE, background = "#E8E8E8")
}

# Print each table with nice formatting
print_pretty_kable(room_type_table, "Room Type")
print_pretty_kable(meal_table, "Meal Option")
print_pretty_kable(market_table, "Market")
print_pretty_kable(parking_table, "Parking")
print_pretty_kable(month_table, "Month")
print_pretty_kable(requests_table, "Special Requests")
print_pretty_kable(children_table, "Has Children")

```

# 3. Statistical Analysis 

*Describe the statistical analysis that you used to answer Research Objectives 1-3. Each analysis should be labeled for the appropriate research objective. This section should summarize all relevant analyses that lead to your final conclusions/decisions/recommendations. Be sure to include:*

- *Model Assumptions & how checked/verified*
- *Interpretation of relevant estimates/statistics/p-values IN CONTEXT*
- *Any data manipulation to create new variables* 

*You should not include your code. However, I would like to see the code for final models that you are using to answer the research objectives in the appendix.* 

## 3.1 Objective 1

Expand on this text...

I do notice that the residuals verses fitted values have some flaring as the lead time increases, consider a square root transformation?


Logit function for Status using LeadTime:
$$\widehat{log(\frac{\pi}{1-\pi})} = 1.8046260 - 0.0117484(LeadTime)$$

$$odds(Status) = e^{1.8046260 - 0.0117484(LeadTime)} $$

Probability function for Status using LeadTime:

$$p(Status) = \widehat \pi = \frac{e^{1.8046260 - 0.0117484(LeadTime)}}{1-e^{1.8046260 - 0.0117484(LeadTime)}}$$

$$odds \space ratio = e^{\widehat \beta_1} = e^{-0.0117484} = 0.988324$$ 

For every 1 day increase of LeadTime, the predicted odds of not cancelling the hotel booking decreases by a factor of 0.988. To further Gold Mine Resorts understanding of these statistics, Visuals of the probabilities and odds of cancellation are included below.

$$H_0: \beta_1 = 0, H_a: \beta_1 \neq 0$$
With a p-value < 2e^-16, we have strong evidence to reject the null hypothesis in favor of the alternative. LeadTime is useful for predicting hotel cancellations.


```{r}

# quantitative predictors
price_model <- glm(factor(Status) ~ AvgPrice, family = binomial(link = "logit"), data = hotel_bookings)
#summary(price_model)

leadtime_model <- glm(factor(Status) ~ LeadTime, family = binomial(link = "logit"), data = hotel_bookings)
#summary(leadtime_model)

staylength_model <- glm(factor(Status) ~ StayLength, family = binomial(link = "logit"), data = hotel_bookings)
#summary(staylength_model)

groupsize_model <- glm(factor(Status) ~ GroupSize, family = binomial(link = "logit"), data = hotel_bookings)
#summary(groupsize_model)

#ASSESS
#converts status to binary where Canceled = 1 and Not_Canceled = 0, checking for linearity
hotel_bookings$Status_binary <- ifelse(hotel_bookings$Status == "Canceled", 1, 0)
emplogitplot1(Status_binary ~ LeadTime, data = hotel_bookings, ngroups = "all")
plot(leadtime_model, which = 1)

#USE
# summary(leadtime_model)

```

```{r}

# Parameters from your logistic regression model
intercept <- 1.8046260
lead_time_coef <- -0.0117484

# Function to calculate probability of cancellation
cancellation_probability <- function(lead_time) {
  logit <- intercept + (lead_time_coef * lead_time)
  probability <- 1 / (1 + exp(-logit))
  return(probability)
}

# Function to calculate odds of cancellation
cancellation_odds <- function(lead_time) {
  prob <- cancellation_probability(lead_time)
  odds <- prob / (1 - prob)
  return(odds)
}

# Create a sequence of lead times from 0 to 365 days
lead_times <- seq(0, 365, by = 1)

# Calculate probabilities and odds for each lead time
probabilities <- sapply(lead_times, cancellation_probability)
odds <- sapply(lead_times, cancellation_odds)

# Create a data frame for plotting
plot_data <- data.frame(
  LeadTime = lead_times,
  Probability = probabilities,
  Odds = odds
)

# Create visualization
# Set up a 2x1 plotting layout
par(mfrow = c(2, 1), mar = c(4, 4, 2, 2))

# Plot 1: Probability vs Lead Time
plot(plot_data$LeadTime, plot_data$Probability, 
     type = "l", col = "royalblue", lwd = 2,
     xlab = "Lead Time (days)", ylab = "Probability of Cancellation",
     main = "Probability of Cancellation vs Lead Time", 
     ylim = c(0, 1))
grid()

# Add reference points
reference_points <- c(0, 30, 60, 90, 180, 365)
reference_probs <- sapply(reference_points, cancellation_probability)
points(reference_points, reference_probs, pch = 19, col = "#FF6B6B")

# Add labels for probability reference points
text(reference_points, reference_probs, 
     labels = paste0(round(reference_probs*100, 1), "%"), 
     pos = 3, col = "gray11")

# Plot 2: Odds vs Lead Time
plot(plot_data$LeadTime, plot_data$Odds, 
     type = "l", col = "midnightblue", lwd = 2,
     xlab = "Lead Time (days)", ylab = "Odds of Cancellation",
     main = "Odds of Cancellation vs Lead Time",
     ylim = c(0, 6))
grid()

# Add reference points for odds
reference_odds <- sapply(reference_points, cancellation_odds)
points(reference_points, reference_odds, pch = 19, col = "#FF6B6B")

# Add labels for odds reference points
text(reference_points, reference_odds, 
     labels = paste0(round(reference_odds, 2)), 
     pos = 3, col = "gray11")

# Reset plotting parameters
par(mfrow = c(1, 1))

# Additional information: Compare probability and odds changes
reference_table <- data.frame(
  LeadTime = reference_points,
  Probability = round(reference_probs, 4),
  ProbabilityPercentage = paste0(round(reference_probs*100, 1), "%"),
  Odds = round(reference_odds, 4)
)

# Print reference table
# print(reference_table)

# Calculate and display odds ratios for different intervals
base_odds <- cancellation_odds(0)
odds_ratios <- sapply(reference_points[-1], function(lt) {
  cancellation_odds(lt) / base_odds
})

cat("\nPercentage change in odds from Lead Time = 0:\n")
for (i in 1:length(odds_ratios)) {
  pct_change <- (odds_ratios[i] - 1) * 100
  cat(sprintf("Lead Time = %d days: %.1f%% change in odds\n", 
              reference_points[i+1], pct_change))
}

# Calculate and display odds ratio for one-day change
one_day_odds_ratio <- exp(lead_time_coef)
cat(sprintf("\nOdds ratio for one-day increase in lead time: %.4f\n", one_day_odds_ratio))
cat(sprintf("This corresponds to a %.2f%% decrease in odds per day\n", 
            (1 - one_day_odds_ratio) * 100))

```

## 3.2 Objective 2

Looking at the AIC for the categorical models, Hasrequests was shown to be the best single categorical explanatory variable for predicting cancellations. As predicted by our exploratory data analysis, this was closely followed month and market.

Add Interpretation of relevant estimates/statistics/p-values IN CONTEXT, note that HasRequests was transformed into a binary variable

Model output for HasRequests:

Coefficients:
            Estimate Std. Error z value Pr(>|z|)    
(Intercept)  0.27328    0.01435   19.04   <2e-16 ***
HasRequests  1.09756    0.02411   45.53   <2e-16 ***

```{r}

modr <- glm(factor(Status) ~ HasRequests, family = binomial(link = "logit"), data = hotel_bookings)
# summary(modr)

plot(modr, which = 1)

#confidence interval for HasRequests
confint.default(modr)

mod1 <- glm(factor(Status) ~ RoomType, family = binomial(link = "logit"), data = hotel_bookings)
# summary(mod1)

# plot(mod1, which = 1)

mod2 <- glm(factor(Status) ~ Parking, family = binomial(link = "logit"), data = hotel_bookings)
# summary(mod2)

# plot(mod2, which = 1)

mod3 <- glm(factor(Status) ~ Market, family = binomial(link = "logit"), data = hotel_bookings)
# summary(mod3)

# plot(mod3, which = 1)

mod4 <- glm(factor(Status) ~ Meal, family = binomial(link = "logit"), data = hotel_bookings)
# summary(mod4)

# plot(mod4, which = 1)

# mod5 <- glm(factor(Status) ~ Month, family = binomial(link = "logit"), data = hotel_bookings)
# summary(mod5)

#plot(mod5, which = 1)

```

## 3.3 Objective 3

When observing the ANOVA table, the HasChildren variable was not statistically significant. We replaced the HasChildren variable with Children and still saw observed a large p value, greater than .2 in both instances. We additionally removed year from the statistical model, since this historical data point is not useful for future predictions.

AIC with the forward step analysis recommended using all the remaining variables, including LeadTime, HasRequests, Market, Month, AvgPrice, Parking, RoomType, StayLength, Meal and GroupSize. The AIC of the model was 30,674. 

Our output code warned us that this model was likely overfitting, so we began used the output from an ANOVA table to eliminate variables one at a time, starting with GroupSize (the highest p value). The final model we selected used LeadTime, Market, Requests, Month, AvgPrice, and StayLength.

While our AIC increased slightly to  31,109, we reduced the variable count from 10 to 6. The model with 10 variables created warnings about over-fitting. The improved 6 variable model had optimized p values for each variable and eliminated the warnings of over fitting.


```{r}
new_model <- glm(factor(Status) ~ LeadTime + factor(Market) + HasRequests + factor(Month) + AvgPrice + StayLength, family = binomial(link = "logit"), data=hotel_bookings)


anova_table <- Anova(new_model, test = "LR")
print(anova_table)

# Get the AIC
AIC(new_model)

```
```{r}
#ASSESS

```

# 4. Conclusions 

*Succinct response to each question laid out in 1.1.  This a much shorter version of section 3, and focuses on conclusions rather than the analysis.*

**Objective 1:**  

Talk about the quantitative model

```{r}

#gets the confidence interval, which does not include 0 therefore valid
confint.default(leadtime_model)
#gets the CI on the odds ratio scale, for every 1 unit increase in LeadTime, the odds of cancellation
#(vs. non-cancellation) multiply by 0.9880 to 0.9881 w/95% confidence
exp(confint.default(leadtime_model))

```

**Objective 2:**

Talk about the categoric model

```{r}

#confidence interval for HasRequests
confint.default(modr)

```


**Objective 3:**

*(all research objectives should be addressed, in the same order)*

Talk about the final model


While this model is a good starting point for predicting hotel cancellations, we noticed that there was a significant increase in both the count of reservations and the count of online reservations that led to cancellations from 2017 to 2018. If Gold Mine Resorts has access to further details about the sources for online bookings, this may prove to be a beneficial research study in the future.


```{r}

# side-by-side bar chart of canceled bookings by market type for 2017-2018
# Filter for canceled bookings in 2017 and 2018 only
canceled_bookings <- hotel_bookings[hotel_bookings$Status == "Canceled" & 
                                    (hotel_bookings$Year == 2017 | 
                                     hotel_bookings$Year == 2018), ]

# Create a binary market type variable (Online vs Non-Online)
canceled_bookings$MarketType <- ifelse(canceled_bookings$Market == "Online", 
                                      "Online", "Non-Online")

# Create a contingency table of counts
cancellation_counts <- table(canceled_bookings$Year, canceled_bookings$MarketType)

# Convert to data frame for ggplot
cancellation_df <- as.data.frame(cancellation_counts)
colnames(cancellation_df) <- c("Year", "MarketType", "Count")

# Convert Year to factor for proper ordering
cancellation_df$Year <- as.factor(cancellation_df$Year)

# Create the side-by-side (unstacked) bar chart
ggplot(cancellation_df, aes(x = Year, y = Count, fill = MarketType)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  scale_fill_manual(values = c("Online" = "darkblue", "Non-Online" = "azure4")) +
  labs(title = "Canceled Bookings by Market Type (2017-2018)",
       subtitle = "Side-by-side comparison of Online vs Non-Online Markets",
       x = "Year",
       y = "Number of Cancellations",
       fill = "Market Type") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10),
    legend.position = "bottom",
    legend.title = element_text(size = 11),
    legend.text = element_text(size = 10),
    panel.grid = element_blank()  # Keep the gridlines removed
  ) +
  # Add data labels on top of each bar
  geom_text(aes(label = Count), position = position_dodge(width = 0.7), 
            vjust = -0.5, size = 3.5) +
  # Set y-axis to start at 0
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)))

```

# 5. Appendix 

*This section should include the code and output for the models used to answer the research objectives.*


```{r}
# quantitative code
price_model <- glm(factor(Status) ~ AvgPrice, family = binomial(link = "logit"), data = hotel_bookings)
summary(price_model)

leadtime_model <- glm(factor(Status) ~ LeadTime, family = binomial(link = "logit"), data = hotel_bookings)
summary(leadtime_model)

staylength_model <- glm(factor(Status) ~ StayLength, family = binomial(link = "logit"), data = hotel_bookings)
summary(staylength_model)

groupsize_model <- glm(factor(Status) ~ GroupSize, family = binomial(link = "logit"), data = hotel_bookings)
summary(groupsize_model)

# categorical code
modr <- glm(factor(Status) ~ Requests, family = binomial(link = "logit"), data = hotel_bookings)
summary(modr)


mod1 <- glm(factor(Status) ~ RoomType, family = binomial(link = "logit"), data = hotel_bookings)
summary(mod1)


mod2 <- glm(factor(Status) ~ Parking, family = binomial(link = "logit"), data = hotel_bookings)
summary(mod2)


mod3 <- glm(factor(Status) ~ Market, family = binomial(link = "logit"), data = hotel_bookings)
summary(mod3)

mod4 <- glm(factor(Status) ~ Meal, family = binomial(link = "logit"), data = hotel_bookings)
summary(mod4)


mod5 <- glm(factor(Status) ~ Month, family = binomial(link = "logit"), data = hotel_bookings)
summary(mod5)

#full model code
full_model <- glm(factor(Status) ~ factor(Meal) + factor(Parking) + factor(RoomType) + LeadTime + factor(Market) + AvgPrice + HasRequests + factor(Month) + StayLength + GroupSize, family = binomial(link = "logit"), data=hotel_bookings)


none <- glm(factor(Status) ~ 1 , family = binomial(link = "logit"), data=hotel_bookings)
step(none,scope=list(upper= full_model), direction = "forward")

anova_table <- Anova(full_model, test = "LR")
print(anova_table)

#final model code
new_model <- glm(factor(Status) ~ LeadTime + factor(Market) + HasRequests + factor(Month) + AvgPrice + StayLength, family = binomial(link = "logit"), data=hotel_bookings)


anova_table <- Anova(new_model, test = "LR")
print(anova_table)

# Get the AIC
AIC(new_model)

```